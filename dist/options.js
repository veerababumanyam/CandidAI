(()=>{"use strict";var e,t,o,n,s={},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return s[e].call(o.exports,o,o.exports,i),o.exports}i.m=s,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"==typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"==typeof o.then)return o}var s=Object.create(null);i.r(s);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&o;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>o[e]));return r.default=()=>o,i.d(s,r),s},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,o)=>(i.f[o](e,t),t)),[])),i.u=e=>e+".js",i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={},n="candidai-chrome-extension:",i.l=(e,t,s,r)=>{if(o[e])o[e].push(t);else{var a,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+s){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",n+s),a.src=e),o[e]=[t];var g=(t,n)=>{a.onerror=a.onload=null,clearTimeout(m);var s=o[e];if(delete o[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(n))),t)return t(n)},m=setTimeout(g.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=g.bind(null,a.onerror),a.onload=g.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={575:0};i.f.j=(t,o)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var s=new Promise(((o,s)=>n=e[t]=[o,s]));o.push(n[2]=s);var r=i.p+i.u(t),a=new Error;i.l(r,(o=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,n[1](a)}}),"chunk-"+t,t)}};var t=(t,o)=>{var n,s,[r,a,c]=o,l=0;if(r.some((t=>0!==e[t]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);c&&c(i)}for(t&&t(o);l<r.length;l++)s=r[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},o=self.webpackChunkcandidai_chrome_extension=self.webpackChunkcandidai_chrome_extension||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();const a=("undefined"!=typeof chrome&&chrome.offscreen&&(chrome.offscreen.Reason.USER_MEDIA,chrome.offscreen.Reason.AUDIO_PLAYBACK),{OPENAI:{name:"OpenAI",baseUrl:"https://api.openai.com/v1",models:["gpt-4","gpt-4-turbo","gpt-3.5-turbo"],maxTokens:4096,rateLimits:{requestsPerMinute:60,tokensPerMinute:9e4,dailyLimit:1e6}},ANTHROPIC:{name:"Anthropic",baseUrl:"https://api.anthropic.com/v1",models:["claude-3-opus","claude-3-sonnet","claude-3-haiku"],maxTokens:4096,rateLimits:{requestsPerMinute:50,tokensPerMinute:4e4,dailyLimit:5e5}},GOOGLE:{name:"Google",baseUrl:"https://generativelanguage.googleapis.com/v1",models:["gemini-pro","gemini-pro-vision"],maxTokens:2048,rateLimits:{requestsPerMinute:60,tokensPerMinute:32e3,dailyLimit:1e6}}}),c=(a.OPENAI.baseUrl,a.OPENAI.rateLimits,a.ANTHROPIC.baseUrl,a.ANTHROPIC.rateLimits,{timeout:3e4,retryAttempts:3,retryDelay:1e3,enableLogging:!0});class l{config;handlers=new Map;pendingRequests=new Map;constructor(e={}){this.config={...c,...e},this.initializeMessageListener()}initializeMessageListener(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage?chrome.runtime.onMessage.addListener(((e,t,o)=>(this.handleIncomingMessage(e,t,o).catch((e=>{console.error("Error handling incoming message:",e),o({success:!1,error:e instanceof Error?e.message:"Unknown error"})})),!0))):console.warn("Chrome extension APIs not available in this environment")}async handleIncomingMessage(e,t,o){const{command:n}=e;this.config.enableLogging&&console.log(`[MessageBroker] Received command: ${n}`,e);const s=this.handlers.get(n);if(s)try{await s(e,t,o)}catch(e){const t=e instanceof Error?e.message:"Unknown error";console.error(`Error in handler for command ${n}:`,e),o({success:!1,error:t})}else o({success:!1,error:"Unknown command",details:`No handler registered for command: ${n}`})}registerHandler(e,t){this.handlers.has(e)&&console.warn(`[MessageBroker] Overwriting existing handler for command: ${e}`),this.handlers.set(e,t),this.config.enableLogging&&console.log(`[MessageBroker] Registered handler for command: ${e}`)}unregisterHandler(e){const t=this.handlers.delete(e);return this.config.enableLogging&&t&&console.log(`[MessageBroker] Unregistered handler for command: ${e}`),t}async sendMessage(e,t){const o={...e,requestId:this.generateRequestId(),timestamp:Date.now()};return this.config.enableLogging&&console.log("[MessageBroker] Sending message:",o),this.sendMessageWithRetry(o,t,0)}async sendMessageWithRetry(e,t,o){try{return await this.sendSingleMessage(e,t)}catch(n){if(o<this.config.retryAttempts)return this.config.enableLogging&&console.warn(`[MessageBroker] Retry attempt ${o+1} for message:`,e.command),await this.delay(this.config.retryDelay*(o+1)),this.sendMessageWithRetry(e,t,o+1);throw n}}async sendSingleMessage(e,t){return new Promise(((o,n)=>{const s=setTimeout((()=>{n(new Error(`Message timeout after ${this.config.timeout}ms`))}),this.config.timeout),r=e=>{clearTimeout(s),chrome.runtime.lastError?n(new Error(chrome.runtime.lastError.message)):e?o(e):n(new Error("No response received"))};try{if("undefined"==typeof chrome||!chrome.runtime)return clearTimeout(s),void n(new Error("Chrome extension APIs not available"));t?chrome.tabs.sendMessage(t,e,r):chrome.runtime.sendMessage(e,r)}catch(e){clearTimeout(s),n(e)}}))}async sendMessageToTab(e,t){return this.sendMessage(t,e)}async sendCommand(e,t){const o={command:e,data:t,timestamp:Date.now()};return this.sendMessage(o)}async sendMessageToServiceWorker(e){return this.sendMessage({...e,target:"service_worker"})}async sendMessageToContentScript(e,t){return this.sendMessageToTab(e,{...t,target:"content_script"})}async broadcastMessage(e){try{const t=(await chrome.tabs.query({})).filter((e=>void 0!==e.id)).map((t=>this.sendMessageToTab(t.id,e).catch((()=>null))));return(await Promise.all(t)).filter((e=>null!==e))}catch(e){return console.error("Error broadcasting message:",e),[]}}generateRequestId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}delay(e){return new Promise((t=>setTimeout(t,e)))}getRegisteredHandlers(){return Array.from(this.handlers.keys())}clearHandlers(){this.handlers.clear(),this.config.enableLogging&&console.log("[MessageBroker] All handlers cleared")}getStats(){return{handlersCount:this.handlers.size,pendingRequestsCount:this.pendingRequests.size}}}class d{messageBroker;state;constructor(){this.messageBroker=new l,this.state={isDirty:!1,isLoading:!1,currentProvider:"openai",apiKeys:{},configuration:{}},this.initializeEventListeners(),this.loadConfiguration()}initializeEventListeners(){this.initializeNavigation();const e=document.getElementById("save-api-keys");e&&e.addEventListener("click",this.saveApiKeys.bind(this));const t=document.getElementById("test-api-keys");t&&t.addEventListener("click",this.testAPIConnections.bind(this));const o=document.getElementById("save-context");o&&o.addEventListener("click",this.saveContext.bind(this));const n=document.getElementById("save-llm-config");n&&n.addEventListener("click",this.saveLlmConfiguration.bind(this));const s=document.getElementById("save-transcription");s&&s.addEventListener("click",this.saveTranscriptionSettings.bind(this));const r=document.getElementById("save-response-style");r&&r.addEventListener("click",this.saveResponseStyle.bind(this));const i=document.getElementById("save-language");i&&i.addEventListener("click",this.saveLanguageSettings.bind(this));const a=document.getElementById("test-microphone");a&&a.addEventListener("click",this.testMicrophone.bind(this));const c=document.getElementById("preview-style");c&&c.addEventListener("click",this.previewResponseStyle.bind(this));const l=document.getElementById("export-data");l&&l.addEventListener("click",this.exportData.bind(this));const d=document.getElementById("clear-data");d&&d.addEventListener("click",this.clearAllData.bind(this)),this.initializeDocumentUpload(),this.initializeLLMReordering()}initializeNavigation(){document.querySelectorAll(".ca-nav__button").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const o=e.getAttribute("data-section");o&&this.switchToSection(o)}))})),this.switchToSection("api-keys")}switchToSection(e){console.log(`🔄 Switching to section: ${e}`);const t=document.querySelectorAll(".ca-nav__button");console.log(`📍 Found ${t.length} navigation buttons`),t.forEach((e=>{e.classList.remove("ca-nav__button--active")}));const o=document.querySelector(`[data-section="${e}"]`);o?(o.classList.add("ca-nav__button--active"),console.log(`✅ Activated button for: ${e}`)):console.error(`❌ Button not found for section: ${e}`);const n=document.querySelectorAll(".ca-section");console.log(`📍 Found ${n.length} sections`),n.forEach((e=>{e.classList.remove("ca-section--active"),e.style.display="none"}));const s=document.querySelector(`#section-${e}`);if(s)s.classList.add("ca-section--active"),s.style.display="block",console.log(`✅ Showed section: section-${e}`);else{console.error(`❌ Section not found: section-${e}`);const t=document.querySelectorAll('[id^="section-"]');console.log("Available sections:",Array.from(t).map((e=>e.id)))}}async loadConfiguration(){try{this.state.isLoading=!0,this.updateLoadingState(!0);const e=await chrome.storage.sync.get();this.state.configuration=e,this.populateApiKeys(e.apiKeys||{}),this.populateLlmConfig(e.llmConfig||{}),this.populateTranscriptionSettings(e.transcription||{}),this.populateResponseStyle(e.responseStyle||{}),this.populateLanguageSettings(e.language||{})}catch(e){console.error("Error loading configuration:",e),this.showNotification("Failed to load configuration","error")}finally{this.state.isLoading=!1,this.updateLoadingState(!1)}}async saveApiKeys(){try{const e=this.collectApiKeys();await chrome.storage.sync.set({apiKeys:e}),this.state.apiKeys=e,this.showNotification("API keys saved successfully","success")}catch(e){console.error("Error saving API keys:",e),this.showNotification("Failed to save API keys","error")}}async testConnection(){try{this.updateLoadingState(!0);const e=await this.messageBroker.sendMessage({command:"TEST_LLM_CONNECTION",payload:{provider:this.state.currentProvider,apiKeys:this.state.apiKeys}});e.success?this.showNotification("Connection successful!","success"):this.showNotification("Connection failed: "+e.error,"error")}catch(e){console.error("Error testing connection:",e),this.showNotification("Connection test failed","error")}finally{this.updateLoadingState(!1)}}async saveContext(){try{const e=this.collectContextData();await chrome.storage.sync.set({context:e}),this.showNotification("Context saved successfully","success")}catch(e){console.error("Error saving context:",e),this.showNotification("Failed to save context","error")}}async saveLlmConfiguration(){try{const e=this.collectLlmConfig();await chrome.storage.sync.set({llmConfig:e}),this.showNotification("LLM configuration saved","success")}catch(e){console.error("Error saving LLM config:",e),this.showNotification("Failed to save LLM configuration","error")}}async saveTranscriptionSettings(){try{const e=this.collectTranscriptionSettings();await chrome.storage.sync.set({transcription:e}),this.showNotification("Transcription settings saved","success")}catch(e){console.error("Error saving transcription settings:",e),this.showNotification("Failed to save transcription settings","error")}}async saveResponseStyle(){try{const e=this.collectResponseStyle();await chrome.storage.sync.set({responseStyle:e}),this.showNotification("Response style saved","success")}catch(e){console.error("Error saving response style:",e),this.showNotification("Failed to save response style","error")}}async saveLanguageSettings(){try{const e=this.collectLanguageSettings();await chrome.storage.sync.set({language:e}),this.showNotification("Language settings saved","success")}catch(e){console.error("Error saving language settings:",e),this.showNotification("Failed to save language settings","error")}}async testMicrophone(){try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach((e=>e.stop())),this.showNotification("Microphone access granted","success")}catch(e){console.error("Microphone test failed:",e),this.showNotification("Microphone access denied","error")}}previewResponseStyle(){const e=this.collectResponseStyle(),t=this.generateStylePreview(e),o=document.getElementById("style-preview");o&&(o.innerHTML=t)}async exportData(){try{const e=await chrome.storage.sync.get(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`candidai-settings-${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(o),this.showNotification("Data exported successfully","success")}catch(e){console.error("Error exporting data:",e),this.showNotification("Failed to export data","error")}}async clearAllData(){if(confirm("Are you sure you want to clear all data? This cannot be undone."))try{await chrome.storage.sync.clear(),await chrome.storage.local.clear(),this.showNotification("All data cleared","success"),location.reload()}catch(e){console.error("Error clearing data:",e),this.showNotification("Failed to clear data","error")}}initializeDocumentUpload(){const e=document.getElementById("resume-dropzone"),t=document.getElementById("resume-input"),o=document.getElementById("resume-preview");if(!e||!t||!o)return;e.addEventListener("dragover",(t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("ca-dropzone--dragover")})),e.addEventListener("dragleave",(t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("ca-dropzone--dragover")})),e.addEventListener("drop",(t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("ca-dropzone--dragover");const o=t.dataTransfer?.files;o&&o.length>0&&this.handleFileUpload(o[0])})),e.addEventListener("click",(()=>{t.click()})),t.addEventListener("change",(e=>{const t=e.target;t.files&&t.files.length>0&&this.handleFileUpload(t.files[0])}));const n=document.getElementById("remove-resume");n&&n.addEventListener("click",(()=>{this.removeUploadedFile()}))}handleFileUpload(e){console.log("📄 File uploaded:",e.name,e.size),["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)?e.size>10485760?this.showToast("File size must be less than 10MB","error"):(this.showFilePreview(e),this.processDocument(e)):this.showToast("Please upload a PDF or DOCX file","error")}showFilePreview(e){const t=document.getElementById("resume-preview"),o=t?.querySelector(".ca-file-preview__name"),n=t?.querySelector(".ca-file-preview__size");if(t&&o&&n){o.textContent=e.name,n.textContent=`${(e.size/1024/1024).toFixed(2)} MB`,t.style.display="flex";const s=document.getElementById("resume-dropzone");s&&(s.style.display="none")}}removeUploadedFile(){const e=document.getElementById("resume-preview"),t=document.getElementById("resume-dropzone"),o=document.getElementById("resume-input");e&&(e.style.display="none"),t&&(t.style.display="flex"),o&&(o.value=""),console.log("📄 File removed")}async processDocument(e){let t="",o={};try{if(console.log("📄 Processing document:",e.name,e.type),this.showToast(`Processing ${e.name}...`,"info"),"application/pdf"===e.type)this.showToast("Extracting text from PDF...","info"),t=await this.extractPdfContent(e),t.startsWith("[PDF Content Extraction Failed:")?this.showToast("PDF extraction failed, but document was processed","warning"):this.showToast("PDF text extracted successfully!","success"),o=this.analyzeResumeContent(t);else{if("application/vnd.openxmlformats-officedocument.wordprocessingml.document"!==e.type)throw new Error(`Unsupported file type: ${e.type}`);this.showToast("Extracting text from DOCX...","info"),t=(await this.extractDocxContent(e)).value,t.startsWith("[DOCX Content Extraction Failed:")?this.showToast("DOCX extraction failed, but document was processed","warning"):this.showToast("DOCX text extracted successfully!","success"),o=this.analyzeResumeContent(t)}this.showToast("Analyzing document content...","info"),await this.storeProcessedDocument(e.name,t,o),this.displayDocumentAnalysis(o);const n=t.split(/\s+/).filter((e=>e.length>0)).length,s=o.skills?.length||0,r=o.experience?.length||0;this.showToast(`✅ Document processed successfully!\n\n📊 ${n} words extracted\n💼 ${s} skills identified\n🎯 ${r} experience entries found`,"success")}catch(t){console.error("❌ Document processing error:",t);let o="Failed to process document";t instanceof Error&&(o=t.message),this.showToast(`❌ Document Processing Failed\n\nError: ${o}\n\n💡 Suggestions:\n• Ensure the file is not corrupted\n• Try a smaller file size\n• Convert to a different format (PDF ↔ DOCX)\n• Check your internet connection`,"error");const n={skills:[],experience:[],education:[],certifications:[],contact:{},summary:`Processing failed for ${e.name}: ${o}`};await this.storeProcessedDocument(e.name,`[Processing failed: ${o}]`,n),this.displayDocumentAnalysis(n)}}async extractPdfContent(e){try{if(console.log("📄 Starting PDF extraction for:",e.name),e.size>52428800)throw new Error("PDF file too large (max 50MB)");const t=await Promise.race([this.loadPdfJsLibrary(),new Promise(((e,t)=>setTimeout((()=>t(new Error("PDF.js library load timeout"))),1e4)))]);console.log("📦 PDF.js library loaded successfully");const o=await e.arrayBuffer();console.log("📄 File converted to ArrayBuffer, size:",o.byteLength);const n=t.getDocument({data:o,verbosity:0,disableAutoFetch:!0,disableStream:!0,disableRange:!0}),s=await n.promise;console.log("📖 PDF loaded, pages:",s.numPages);let r="";const i=Math.min(s.numPages,20);for(let e=1;e<=i;e++)try{const t=await s.getPage(e),o=(await t.getTextContent()).items.map((e=>e.str||"")).join(" ");o.trim()&&(r+=o+"\n\n"),console.log(`📄 Extracted text from page ${e}/${i}`)}catch(t){console.warn(`⚠️ Failed to extract page ${e}:`,t),r+=`[Page ${e} extraction failed]\n\n`}if(s.numPages>20&&(r+=`\n[Note: Document has ${s.numPages} pages, only first 20 processed for performance]`),r=r.replace(/\s+/g," ").replace(/\n\s*\n/g,"\n").trim(),!r||r.length<10)throw new Error("No readable text found in PDF");return console.log("✅ PDF extraction successful, text length:",r.length),r}catch(t){console.error("❌ PDF extraction error:",t);let o="Failed to extract PDF content";return t instanceof Error&&(o=t.message.includes("Invalid PDF")?"Invalid or corrupted PDF file":t.message.includes("timeout")?"PDF processing timeout - file may be too complex":t.message.includes("too large")?t.message:`PDF processing error: ${t.message}`),`[PDF Content Extraction Failed: ${o}]\n\nFilename: ${e.name}\nSize: ${(e.size/1024/1024).toFixed(2)} MB\n\nPlease try with a different PDF file or convert to DOCX format.`}}async loadPdfJsLibrary(){return new Promise(((e,t)=>{if(window.pdfjsLib)return void e(window.pdfjsLib);const o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",o.onload=()=>{const o=window.pdfjsLib;o?(o.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",e(o)):t(new Error("PDF.js failed to load"))},o.onerror=()=>t(new Error("Failed to load PDF.js")),document.head.appendChild(o)}))}async extractDocxContent(e){try{if(console.log("📄 Starting DOCX extraction for:",e.name),e.size>20971520)throw new Error("DOCX file too large (max 20MB)");const t=await e.arrayBuffer();console.log("📄 File converted to ArrayBuffer, size:",t.byteLength);try{const e=await i.e(306).then(i.t.bind(i,306,19));console.log("📦 Mammoth library loaded successfully");const o=await e.extractRawText({arrayBuffer:t});if(console.log("✅ DOCX extraction successful, text length:",o.value.length),!o.value||o.value.trim().length<10)throw new Error("No readable text found in DOCX");return o}catch(e){return console.warn("⚠️ Mammoth library not available, trying fallback method"),{value:await this.extractDocxFallback(t),messages:[{type:"warning",message:"Used fallback extraction method"}]}}}catch(t){console.error("❌ DOCX extraction error:",t);let o="Failed to extract DOCX content";return t instanceof Error&&(o=t.message.includes("too large")?t.message:t.message.includes("Invalid")?"Invalid or corrupted DOCX file":`DOCX processing error: ${t.message}`),{value:`[DOCX Content Extraction Failed: ${o}]\n\nFilename: ${e.name}\nSize: ${(e.size/1024/1024).toFixed(2)} MB\n\nPlease try with a different DOCX file or convert to PDF format.`,messages:[{type:"error",message:o}]}}}async extractDocxFallback(e){try{const t=new Uint8Array(e),o=new TextDecoder("utf-8",{fatal:!1}).decode(t),n=o.match(/<w:t[^>]*>([^<]+)<\/w:t>/g);if(n&&n.length>0){const e=n.map((e=>e.replace(/<[^>]*>/g,""))).join(" ").replace(/\s+/g," ").trim();if(e.length>10)return console.log("✅ Fallback DOCX extraction successful"),e}const s=o.replace(/[^\x20-\x7E\n\r\t]/g," ").replace(/\s+/g," ").split(" ").filter((e=>e.length>2&&/[a-zA-Z]/.test(e))).join(" ").trim();if(s.length>50)return console.log("⚠️ Basic text extraction from DOCX"),s.slice(0,5e3);throw new Error("No readable content found using fallback method")}catch(e){throw console.error("❌ Fallback DOCX extraction failed:",e),new Error("All DOCX extraction methods failed")}}analyzeResumeContent(e){return{skills:this.extractSkills(e),experience:this.extractExperience(e),education:this.extractEducation(e),certifications:this.extractCertifications(e),contact:this.extractContactInfo(e),summary:this.generateDocumentSummary(e)}}extractSkills(e){const t=new Set;return[/(?:skills?|technologies|tools|programming|software|languages?):\s*(.+)/gi,/(?:proficient|experienced|skilled)\s+(?:in|with)\s+(.+)/gi,/(?:javascript|python|java|react|angular|vue|node\.?js|typescript|html|css|sql|aws|docker|kubernetes)/gi].forEach((o=>{const n=e.matchAll(o);for(const e of n)e[1]?e[1].split(/[,;\n|]/).forEach((e=>{const o=e.trim().replace(/[^\w\s.+-]/g,"");o.length>2&&o.length<30&&t.add(o)})):e[0]&&t.add(e[0].trim())})),Array.from(t).slice(0,20)}extractExperience(e){const t=[];return[/(?:(\d{4})\s*[-–]\s*(?:(\d{4})|present|current))\s*(.+?)(?=\d{4}|$)/gis,/(?:work|employment|professional)\s+(?:experience|history):\s*(.+?)(?=education|skills|$)/gis].forEach((o=>{const n=e.matchAll(o);for(const e of n)e[1]&&e[3]&&t.push({startYear:e[1],endYear:e[2]||"Present",description:e[3].trim().slice(0,200)})})),t.slice(0,10)}extractEducation(e){const t=[];return[/(?:bachelor|master|phd|doctorate|degree|university|college|academy)\s+(.+?)(?=\d{4}|work|experience|skills|$)/gis,/(?:education|academic)\s+(?:background|history):\s*(.+?)(?=work|experience|skills|$)/gis].forEach((o=>{const n=e.matchAll(o);for(const e of n)e[1]&&t.push({description:e[1].trim().slice(0,150)})})),t.slice(0,5)}extractCertifications(e){const t=new Set;return[/(?:certification|certificate|certified)(?:\s+(?:in|of|for))?\s*(.+?)(?=\n|$)/gis,/(?:aws|azure|google|microsoft|cisco|oracle|salesforce|scrum|pmp|comptia)\s+certified/gis].forEach((o=>{const n=e.matchAll(o);for(const e of n)e[1]?t.add(e[1].trim().slice(0,50)):e[0]&&t.add(e[0].trim())})),Array.from(t).slice(0,10)}extractContactInfo(e){return{email:e.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/)?.[0]||"",phone:e.match(/(?:\+?1[-.\s]?)?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}/)?.[0]||"",linkedin:e.match(/linkedin\.com\/(?:in\/)?([a-zA-Z0-9-]+)/)?.[0]||"",github:e.match(/github\.com\/([a-zA-Z0-9-]+)/)?.[0]||""}}generateDocumentSummary(e){const t=[/(?:summary|profile|objective|about)\s*:?\s*(.+?)(?=(?:experience|skills|education)|$)/gis,/^(.{100,300}?)(?:\.|$)/s];for(const o of t){const t=e.match(o);if(t&&t[1])return t[1].trim().slice(0,300)}return e.slice(0,200)+"..."}async storeProcessedDocument(e,t,o){try{const n={filename:e,content:t,analysis:o,processedAt:(new Date).toISOString(),wordCount:t.split(/\s+/).length};if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local){const e=(await chrome.storage.local.get("processedDocuments")).processedDocuments||[];e.push(n),e.length>10&&e.splice(0,e.length-10),await chrome.storage.local.set({processedDocuments:e}),console.log("✅ Document stored in Chrome storage")}else{const e=JSON.parse(localStorage.getItem("processedDocuments")||"[]");e.push(n),e.length>10&&e.splice(0,e.length-10),localStorage.setItem("processedDocuments",JSON.stringify(e)),console.log("✅ Document stored in localStorage")}}catch(e){console.error("❌ Error storing document:",e)}}displayDocumentAnalysis(e){const t=document.getElementById("document-analysis");t&&(t.innerHTML=`\n      <div class="ca-analysis">\n        <h4>📄 Document Analysis</h4>\n        \n        <div class="ca-analysis__section">\n          <h5>💼 Skills (${e.skills.length})</h5>\n          <div class="ca-tags">\n            ${e.skills.slice(0,10).map((e=>`<span class="ca-tag">${e}</span>`)).join("")}\n          </div>\n        </div>\n        \n        <div class="ca-analysis__section">\n          <h5>🎯 Experience (${e.experience.length} entries)</h5>\n          ${e.experience.slice(0,3).map((e=>`<div class="ca-experience">${e.startYear} - ${e.endYear}: ${e.description.slice(0,100)}...</div>`)).join("")}\n        </div>\n        \n        <div class="ca-analysis__section">\n          <h5>🎓 Education</h5>\n          ${e.education.slice(0,2).map((e=>`<div class="ca-education">${e.description}</div>`)).join("")}\n        </div>\n        \n        <div class="ca-analysis__section">\n          <h5>📜 Certifications (${e.certifications.length})</h5>\n          <div class="ca-tags">\n            ${e.certifications.slice(0,5).map((e=>`<span class="ca-tag ca-tag--cert">${e}</span>`)).join("")}\n          </div>\n        </div>\n        \n        <div class="ca-analysis__section">\n          <h5>📞 Contact</h5>\n          <div class="ca-contact">\n            ${e.contact.email?`<div>✉️ ${e.contact.email}</div>`:""}\n            ${e.contact.phone?`<div>📱 ${e.contact.phone}</div>`:""}\n            ${e.contact.linkedin?`<div>💼 ${e.contact.linkedin}</div>`:""}\n            ${e.contact.github?`<div>🐙 ${e.contact.github}</div>`:""}\n          </div>\n        </div>\n      </div>\n    `,t.style.display="block")}initializeLLMReordering(){if(console.log("🔄 Initializing LLM fallback reordering..."),this.updateSortableStatus("loading"),void 0===window.Sortable){console.log("📦 Loading SortableJS library...");const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js",e.onload=()=>{console.log("✅ SortableJS loaded successfully"),this.setupSortable()},e.onerror=()=>{console.error("❌ Failed to load SortableJS"),this.updateSortableStatus("error"),this.showToast("Failed to load drag & drop functionality","error")},document.head.appendChild(e)}else console.log("✅ SortableJS already available"),this.setupSortable()}updateSortableStatus(e){const t=document.getElementById("sortable-status");if(!t)return;const o=t.querySelector(".ca-loading-text"),n=t.querySelector(".ca-ready-text");if(o&&n)switch(e){case"loading":o.style.display="inline",n.style.display="none";break;case"ready":o.style.display="none",n.style.display="inline";break;case"error":o.textContent="❌ Drag & drop failed to load",o.style.color="var(--ca-red-600)",n.style.display="none"}}setupSortable(){const e=document.getElementById("fallback-order");if(!e||void 0===window.Sortable)return console.error("❌ Cannot setup sortable: container or library missing"),void this.updateSortableStatus("error");try{new window.Sortable(e,{animation:200,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",handle:".ca-drag-handle",scroll:!0,scrollSensitivity:100,scrollSpeed:10,onStart:t=>{console.log("🎯 Drag started from position:",t.oldIndex),e.classList.add("sortable-drag-active"),this.showToast("Drag to reorder LLM providers","info")},onEnd:t=>{console.log("🔄 LLM order changed:",t.oldIndex,"->",t.newIndex),e.classList.remove("sortable-drag-active"),t.oldIndex!==t.newIndex&&(this.updatePriorityIndicators(),this.saveLLMFallbackOrder(),this.showToast("LLM fallback order updated successfully!","success"))},onMove:e=>!0}),console.log("✅ LLM fallback reordering initialized successfully"),this.updateSortableStatus("ready"),this.updatePriorityIndicators()}catch(e){console.error("❌ Failed to initialize sortable:",e),this.updateSortableStatus("error"),this.showToast("Failed to initialize drag & drop functionality","error")}}updatePriorityIndicators(){document.querySelectorAll(".ca-fallback-item").forEach(((e,t)=>{const o=e.querySelector(".ca-priority-indicator");o&&(o.textContent=(t+1).toString(),o.style.transform="scale(1.2)",setTimeout((()=>{o.style.transform="scale(1)"}),200))}))}saveLLMFallbackOrder(){try{const e=document.querySelectorAll(".ca-fallback-item"),t=Array.from(e).map((e=>e.dataset.provider)).filter(Boolean);if(0===t.length)return console.error("❌ No valid providers found in fallback order"),void this.showToast("Error: No valid providers found","error");console.log("💾 Saving LLM fallback order:",t),"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.set({llmFallbackOrder:t},(()=>{chrome.runtime.lastError?(console.error("❌ Chrome storage error:",chrome.runtime.lastError),this.showToast("Failed to save configuration","error")):console.log("✅ LLM fallback order saved to Chrome storage")})):(localStorage.setItem("llmFallbackOrder",JSON.stringify(t)),console.log("✅ LLM fallback order saved to localStorage")),this.updateProviderOrderDisplay(t)}catch(e){console.error("❌ Error saving LLM fallback order:",e),this.showToast("Failed to save fallback order","error")}}updateProviderOrderDisplay(e){console.log("🔄 Provider order updated:",e.map(((e,t)=>`${t+1}. ${e}`)).join(", "))}async testAPIConnections(){const e=this.getAPIKeys(),t={openai:!1,anthropic:!1,gemini:!1},o={};this.showToast("Testing API connections...","info");try{if(e.openai)try{t.openai=await this.testOpenAIConnection(e.openai),o.openai={success:t.openai},t.openai||(o.openai.error="Invalid API key or connection failed")}catch(e){t.openai=!1,o.openai={success:!1,error:e instanceof Error?e.message:"Connection failed"}}if(e.anthropic)try{t.anthropic=await this.testAnthropicConnection(e.anthropic),o.anthropic={success:t.anthropic},t.anthropic||(o.anthropic.error="Invalid API key or connection failed")}catch(e){t.anthropic=!1,o.anthropic={success:!1,error:e instanceof Error?e.message:"Connection failed"}}if(e.gemini)try{t.gemini=await this.testGeminiConnection(e.gemini),o.gemini={success:t.gemini},t.gemini||(o.gemini.error="Invalid API key or connection failed")}catch(e){t.gemini=!1,o.gemini={success:!1,error:e instanceof Error?e.message:"Connection failed"}}const n=Object.values(t).filter(Boolean).length,s=Object.values(e).filter(Boolean).length;if(0===s)return void this.showToast("⚠️ No API keys found to test. Please enter your API keys first.","warning");const r={openai:"OpenAI",anthropic:"Anthropic",gemini:"Google Gemini"},i=[],a=[];for(const[e,t]of Object.entries(o))t.success?i.push(r[e]):a.push(`${r[e]}: ${t.error||"Unknown error"}`);if(n===s)this.showToast(`✅ All API connections successful!\n${i.join(", ")} are working properly.`,"success");else if(n>0){let e=`⚠️ ${n}/${s} API connections successful\n\n`;i.length>0&&(e+=`✅ Working: ${i.join(", ")}\n`),a.length>0&&(e+=`❌ Failed: \n${a.map((e=>`• ${e}`)).join("\n")}`),this.showToast(e,"warning")}else{const e=`❌ All API connections failed:\n${a.map((e=>`• ${e}`)).join("\n")}\n\nPlease check your API keys and try again.`;this.showToast(e,"error")}console.log("🔑 Detailed API Test Results:",o)}catch(e){console.error("API testing error:",e),this.showToast("❌ API testing failed. Check console for details.","error")}}async testOpenAIConnection(e){try{const t=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`}});if(t.ok)return!0;throw 401===t.status?new Error("Invalid OpenAI API key"):429===t.status?new Error("OpenAI API rate limit exceeded"):t.status>=500?new Error("OpenAI server error"):new Error(`OpenAI API error (${t.status})`)}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network connection failed - check your internet connection");throw e}}async testAnthropicConnection(e){try{const t=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":e,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:1,messages:[{role:"user",content:"Hi"}]})});if(t.status>=200&&t.status<300)return!0;if(400===t.status)return!0;throw 401===t.status?new Error("Invalid Anthropic API key"):403===t.status?new Error("Anthropic API key lacks required permissions"):429===t.status?new Error("Anthropic API rate limit exceeded"):t.status>=500?new Error("Anthropic server error"):new Error(`Anthropic API error (${t.status})`)}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network connection failed - check your internet connection");if(e instanceof Error)throw e;throw new Error("Unknown error occurred while testing Anthropic API")}}async testGeminiConnection(e){try{if(!e.startsWith("AIza"))throw new Error('Invalid Google Gemini API key format - should start with "AIza"');const t=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${e}`);if(t.ok){const e=await t.json();if(e.models&&e.models.length>0)return!0;throw new Error("No models available with this Google Gemini API key")}if(400===t.status){const e=await t.json().catch((()=>null));throw new Error(`Google Gemini API error: ${e?.error?.message||"Invalid request format"}`)}throw 403===t.status?new Error("Google Gemini API access forbidden - check your API key permissions and billing"):429===t.status?new Error("Google Gemini API rate limit exceeded"):t.status>=500?new Error("Google Gemini server error"):new Error(`Google Gemini API error (${t.status})`)}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw new Error("Network connection failed - check your internet connection");throw e}}getAPIKeys(){const e=document.getElementById("openai-key"),t=document.getElementById("anthropic-key"),o=document.getElementById("gemini-key");return{openai:e?.value||"",anthropic:t?.value||"",gemini:o?.value||""}}collectApiKeys(){const e={},t=document.getElementById("openai-key")?.value,o=document.getElementById("anthropic-key")?.value,n=document.getElementById("gemini-key")?.value;return t&&(e.openai=t),o&&(e.anthropic=o),n&&(e.gemini=n),e}collectContextData(){const e=document.getElementById("job-description")?.value;return{jobDescription:e||"",uploadedAt:(new Date).toISOString()}}collectLlmConfig(){const e=document.getElementById("preferred-provider")?.value;return{preferredProvider:e||"openai",updatedAt:(new Date).toISOString()}}collectTranscriptionSettings(){const e=document.getElementById("transcription-language")?.value,t=document.getElementById("silence-threshold")?.value,o=document.getElementById("silence-duration")?.value;return{language:e||"en-US",silenceThreshold:parseFloat(t)||.01,silenceDuration:parseInt(o)||1500}}collectResponseStyle(){const e=document.getElementById("response-tone")?.value,t=document.getElementById("response-length")?.value,o=document.getElementById("formality-level")?.value;return{tone:e||"professional",length:t||"medium",formality:parseInt(o)||7}}collectLanguageSettings(){const e=document.getElementById("ui-language")?.value,t=document.getElementById("response-language")?.value,o=document.getElementById("date-format")?.value,n=document.getElementById("time-format")?.value;return{interface:e||"English",aiResponse:t||"English",dateFormat:o||"MM/DD/YYYY",timeFormat:n||"12-hour"}}populateApiKeys(e){const t=document.getElementById("openai-key"),o=document.getElementById("anthropic-key"),n=document.getElementById("gemini-key");t&&e.openai&&(t.value=e.openai),o&&e.anthropic&&(o.value=e.anthropic),n&&e.gemini&&(n.value=e.gemini)}populateLlmConfig(e){const t=document.getElementById("preferred-provider");t&&e.preferredProvider&&(t.value=e.preferredProvider)}populateTranscriptionSettings(e){const t=document.getElementById("transcription-language"),o=document.getElementById("silence-threshold"),n=document.getElementById("silence-duration");t&&e.language&&(t.value=e.language),o&&e.silenceThreshold&&(o.value=e.silenceThreshold.toString()),n&&e.silenceDuration&&(n.value=e.silenceDuration.toString())}populateResponseStyle(e){const t=document.getElementById("response-tone"),o=document.getElementById("response-length"),n=document.getElementById("formality-level");t&&e.tone&&(t.value=e.tone),o&&e.length&&(o.value=e.length),n&&e.formality&&(n.value=e.formality.toString())}populateLanguageSettings(e){const t=document.getElementById("ui-language"),o=document.getElementById("response-language"),n=document.getElementById("date-format"),s=document.getElementById("time-format");t&&e.interface&&(t.value=e.interface),o&&e.aiResponse&&(o.value=e.aiResponse),n&&e.dateFormat&&(n.value=e.dateFormat),s&&e.timeFormat&&(s.value=e.timeFormat)}generateStylePreview(e){return`\n      <div class="preview-card">\n        <h4>Preview Response</h4>\n        <p>This is how your AI responses will look with the selected style settings.</p>\n        <p><strong>Tone:</strong> ${e.tone||"professional"}</p>\n        <p><strong>Length:</strong> ${e.length||"medium"}</p>\n        <p><strong>Formality:</strong> ${e.formality||7}/10</p>\n      </div>\n    `}updateLoadingState(e){document.querySelectorAll("button").forEach((t=>{t.disabled=e}))}showNotification(e,t="info"){console.log(`${t.toUpperCase()}: ${e}`);const o=document.createElement("div");o.className=`notification notification--${t}`,o.textContent=e,document.body.appendChild(o),setTimeout((()=>{o.remove()}),3e3)}showToast(e,t="info"){console.log(`🍞 TOAST ${t.toUpperCase()}: ${e}`);const o=e.replace(/\n/g,"<br>"),n=document.createElement("div");if(n.className=`toast toast--${t}`,n.innerHTML=`\n      <div class="toast__content">\n        <div class="toast__message">${o}</div>\n        <button class="toast__close" onclick="this.parentElement.parentElement.remove()">×</button>\n      </div>\n    `,!document.querySelector("#toast-styles")){const e=document.createElement("style");e.id="toast-styles",e.textContent="\n        .toast {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: white;\n          border-radius: 8px;\n          box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n          z-index: 10000;\n          min-width: 350px;\n          max-width: 500px;\n          animation: slideIn 0.3s ease;\n        }\n        .toast--success { border-left: 4px solid #10b981; }\n        .toast--error { border-left: 4px solid #ef4444; }\n        .toast--warning { border-left: 4px solid #f59e0b; }\n        .toast--info { border-left: 4px solid #3b82f6; }\n        .toast__content {\n          display: flex;\n          align-items: flex-start;\n          justify-content: space-between;\n          padding: 16px;\n        }\n        .toast__message { \n          flex: 1; \n          font-size: 14px; \n          line-height: 1.5;\n          word-wrap: break-word;\n          white-space: pre-wrap;\n        }\n        .toast__close {\n          background: none;\n          border: none;\n          font-size: 18px;\n          cursor: pointer;\n          color: #666;\n          margin-left: 12px;\n          align-self: flex-start;\n          margin-top: -2px;\n        }\n        .toast__close:hover {\n          color: #333;\n        }\n        @keyframes slideIn {\n          from { transform: translateX(100%); opacity: 0; }\n          to { transform: translateX(0); opacity: 1; }\n        }\n      ",document.head.appendChild(e)}document.body.appendChild(n);const s=e.length>100?8e3:5e3;setTimeout((()=>{n.parentElement&&n.remove()}),s)}initialize(){console.log("🚀 CandidAI Options page initialized"),this.initializeEventListeners(),this.initializeNavigation(),this.initializeDocumentUpload(),this.initializeLLMReordering(),this.loadConfiguration()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{(new d).initialize()})):(new d).initialize()})();